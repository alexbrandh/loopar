<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Test AR Simple</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/aframe/build/aframe-ar-nft.js"></script>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }
        
        #info {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            z-index: 1000;
            font-size: 12px;
            max-width: 300px;
        }
        
        #debug {
            position: fixed;
            bottom: 10px;
            left: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            z-index: 1000;
            font-size: 10px;
            max-width: 300px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div id="info">
        <strong>Test AR Simple</strong><br>
        Estado: <span id="status">Inicializando...</span><br>
        C√°mara: <span id="camera-status">Verificando...</span><br>
        Tracking: <span id="tracking-status">No detectado</span>
    </div>
    
    <div id="debug">
        <strong>Debug Log:</strong><br>
        <div id="debug-log"></div>
    </div>

    <a-scene
        vr-mode-ui="enabled: false"
        renderer="logarithmicDepthBuffer: true; antialias: true; colorManagement: true; alpha: true;"
        arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: true; detectionMode: mono_and_matrix; matrixCodeType: 3x3; maxDetectionRate: 20; smooth: true; smoothCount: 3; smoothTolerance: 0.02; smoothThreshold: 3;"
        embedded
        style="height: 100vh; width: 100vw;"
    >
        <a-assets timeout="30000">
            <video
                id="vid"
                src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4"
                preload="auto"
                loop
                crossorigin="anonymous"
                autoplay
                muted
                playsinline
                controls="false"
            ></video>
        </a-assets>

        <!-- Usar descriptores NFT de prueba de AR.js -->
        <a-nft
            type="nft"
            url="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/data/dataNFT/pinball"
            smooth="true"
            smoothCount="5"
            smoothTolerance="0.01"
            smoothThreshold="2"
            emitevents="true"
            id="nft-marker"
        >
            <a-video
                src="#vid"
                position="0 0 0"
                rotation="-90 0 0"
                width="1"
                height="1.78"
                opacity="0.95"
                material="shader: flat; transparent: true; alphaTest: 0.1;"
                geometry="primitive: plane;"
            ></a-video>
        </a-nft>

        <a-entity camera look-controls-enabled="false"></a-entity>
    </a-scene>

    <script>
        const statusEl = document.getElementById('status');
        const cameraStatusEl = document.getElementById('camera-status');
        const trackingStatusEl = document.getElementById('tracking-status');
        const debugLogEl = document.getElementById('debug-log');
        
        function log(message) {
            console.log(message);
            debugLogEl.innerHTML += message + '<br>';
            debugLogEl.scrollTop = debugLogEl.scrollHeight;
        }
        
        function updateStatus(status) {
            statusEl.textContent = status;
            log(`Status: ${status}`);
        }
        
        function updateCameraStatus(status) {
            cameraStatusEl.textContent = status;
            log(`Camera: ${status}`);
        }
        
        function updateTrackingStatus(status) {
            trackingStatusEl.textContent = status;
            log(`Tracking: ${status}`);
        }
        
        // Verificar acceso a c√°mara
        async function checkCamera() {
            try {
                updateCameraStatus('Solicitando acceso...');
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                updateCameraStatus('‚úÖ Acceso concedido');
                stream.getTracks().forEach(track => track.stop());
                return true;
            } catch (error) {
                updateCameraStatus('‚ùå Error: ' + error.message);
                return false;
            }
        }
        
        // Eventos de AR
        document.addEventListener('markerFound', () => {
            updateTrackingStatus('‚úÖ Marcador detectado');
            log('üéØ Marcador NFT encontrado!');
        });
        
        document.addEventListener('markerLost', () => {
            updateTrackingStatus('‚ùå Marcador perdido');
            log('‚ùå Marcador NFT perdido');
        });
        
        // Eventos de A-Frame
        document.querySelector('a-scene').addEventListener('loaded', () => {
            updateStatus('‚úÖ A-Frame cargado');
            log('‚úÖ Escena A-Frame cargada');
        });
        
        // Eventos de video
        const video = document.getElementById('vid');
        video.addEventListener('loadstart', () => log('üé¨ Video: Iniciando carga'));
        video.addEventListener('loadeddata', () => log('‚úÖ Video: Datos cargados'));
        video.addEventListener('canplay', () => log('‚ñ∂Ô∏è Video: Listo para reproducir'));
        video.addEventListener('play', () => log('‚ñ∂Ô∏è Video: Reproduciendo'));
        video.addEventListener('error', (e) => log('‚ùå Video error: ' + e.message));
        
        // Inicializaci√≥n
        window.addEventListener('load', async () => {
            updateStatus('Verificando c√°mara...');
            const cameraOk = await checkCamera();
            
            if (cameraOk) {
                updateStatus('‚úÖ Listo para AR');
                log('‚úÖ Sistema listo. Apunta la c√°mara a la imagen de pinball de AR.js');
                log('üì± Imagen de prueba: https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/data/images/pinball.jpg');
            } else {
                updateStatus('‚ùå Error de c√°mara');
            }
        });
        
        // Log de errores globales
        window.addEventListener('error', (e) => {
            log('‚ùå Error global: ' + e.message);
        });
        
        // Log inicial
        log('üöÄ Iniciando test AR simple...');
    </script>
</body>
</html>