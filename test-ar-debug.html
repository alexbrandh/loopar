<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Debug Test</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/aframe/build/aframe-ar-nft.js"></script>
    <style>
        body { margin: 0; overflow: hidden; }
        #debug {
            position: fixed;
            bottom: 10px;
            left: 10px;
            background: rgba(0,0,0,0.8);
            color: #0f0;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
            max-width: 90%;
            max-height: 200px;
            overflow: auto;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div id="debug"></div>
    
    <a-scene
        embedded
        vr-mode-ui="enabled: false"
        renderer="logarithmicDepthBuffer: true; antialias: true;"
        arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: true; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
    >
        <a-assets>
            <video
                id="test-video"
                src="https://qllfquoqrxvfgdudnrrr.supabase.co/storage/v1/object/sign/postcard-videos/user_31J9GscxynzmpAVeWeOqNddwXwS/df722d96-e260-48c6-8d77-6cb9b0bad6ab/video.MOV?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9lYzBlMjg4Ni01ZDYyLTRkODQtOWYwMS1lNmU5NzMyYmVlNDMiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJwb3N0Y2FyZC12aWRlb3MvdXNlcl8zMUo5R3NjeHluem1wQVZlV2VPcU5kZHdYd1MvZGY3MjJkOTYtZTI2MC00OGM2LThkNzctNmNiOWIwYmFkNmFiL3ZpZGVvLk1PViIsImlhdCI6MTc2NDAxMTkwNiwiZXhwIjoxNzY0MDE1NTA2fQ.W16EGYMGk9yFNVtUXjPDrQXqQvakylzQjzN9LCM7-Fw"
                preload="auto"
                crossorigin="anonymous"
                playsinline
                webkit-playsinline
                muted
                loop
            ></video>
        </a-assets>

        <a-nft
            id="marker"
            type="nft"
            url="http://localhost:3000/api/ar/nft/user_31J9GscxynzmpAVeWeOqNddwXwS/df722d96-e260-48c6-8d77-6cb9b0bad6ab/descriptors"
            smooth="true"
            smoothCount="10"
            smoothTolerance="0.01"
            smoothThreshold="5"
        >
            <!-- Try different positions and sizes -->
            <a-plane
                material="shader: flat; src: #test-video; transparent: false; opacity: 1;"
                position="0 100 0"
                rotation="-90 0 0"
                width="300"
                height="200"
            ></a-plane>
        </a-nft>

        <a-entity camera></a-entity>
    </a-scene>

    <script>
        const debug = document.getElementById('debug');
        const logs = [];
        
        function log(msg) {
            const timestamp = new Date().toLocaleTimeString();
            logs.push(`[${timestamp}] ${msg}`);
            if (logs.length > 10) logs.shift();
            debug.innerHTML = logs.join('<br>');
            console.log(msg);
        }

        log('Iniciando AR test...');

        const video = document.getElementById('test-video');
        const marker = document.getElementById('marker');

        video.addEventListener('loadeddata', () => {
            log('âœ… Video cargado');
            video.pause();
        });

        video.addEventListener('error', (e) => {
            log('âŒ Error de video: ' + e.message);
        });

        if (marker) {
            marker.addEventListener('markerFound', () => {
                log('ðŸŽ¯ Marcador detectado!');
                video.play().catch(e => log('Error play: ' + e));
            });

            marker.addEventListener('markerLost', () => {
                log('ðŸ‘‹ Marcador perdido');
                video.pause();
            });
        }

        log('Event listeners configurados');
    </script>
</body>
</html>
